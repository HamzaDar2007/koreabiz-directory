
> koreabiz-directory-backend@1.0.0 test:e2e
> jest --config ./test/jest-e2e.json test/media-features.e2e-spec.ts

  console.log
    DEBUG: JwtStrategy constructor using secret (prefix): test-...

      at new JwtStrategy (../src/modules/auth/strategies/jwt.strategy.ts:18:13)
          at async Promise.all (index 4)
          at async Promise.all (index 13)

  console.log
    DEBUG: Registering user: mediauser-1767809624099@example.com

      at AuthService.register (../src/modules/auth/auth.service.ts:34:13)

  console.error
    Failed to send verification email: Error: connect ECONNREFUSED 127.0.0.1:587
        at TCPConnectWrap.afterConnect [as oncomplete] (node:net:1607:16) {
      errno: -4078,
      code: 'ESOCKET',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 587,
      command: 'CONN'
    }

    [0m [90m 40 |[39m       [36mawait[39m [36mthis[39m[33m.[39memailService[33m.[39msendVerificationEmail(user[33m.[39memail[33m,[39m [32m'dummy-token'[39m)[33m;[39m
     [90m 41 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 42 |[39m       console[33m.[39merror([32m'Failed to send verification email:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 43 |[39m     }
     [90m 44 |[39m
     [90m 45 |[39m     [36mconst[39m payload [33m=[39m { email[33m:[39m user[33m.[39memail[33m,[39m sub[33m:[39m user[33m.[39mid[33m,[39m iat[33m:[39m [33mMath[39m[33m.[39mfloor([33mDate[39m[33m.[39mnow() [33m/[39m [35m1000[39m) }[33m;[39m[0m

      at AuthService.register (../src/modules/auth/auth.service.ts:42:15)
      at ../node_modules/@nestjs/core/router/router-execution-context.js:46:28
      at ../node_modules/@nestjs/core/router/router-proxy.js:9:17

{"level":"info","message":{"duration":"310ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":201,"url":"/v1/auth/register","userAgent":""},"timestamp":"2026-01-07T18:13:45.780Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"96ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":400,"url":"/v1/enterprises","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:45.917Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"30ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":201,"url":"/v1/media/enterprises/undefined/presigned","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:46.014Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"168ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":500,"url":"/v1/media/enterprises/undefined/register","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:46.211Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"74ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":500,"url":"/v1/media/enterprises/undefined","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:46.317Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"26ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":400,"url":"/v1/media/enterprises/undefined/presigned","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:46.381Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"44ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":400,"url":"/v1/media/enterprises/undefined/register","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:46.456Z"}
  console.log
    DEBUG: JwtAuthGuard error: Unauthorized

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:56:15)

{"level":"info","message":{"duration":"13ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":401,"url":"/v1/media/enterprises/undefined/presigned","userAgent":""},"timestamp":"2026-01-07T18:13:46.523Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"54ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":500,"url":"/v1/media/enterprises/undefined/register","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:46.622Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"35ms","ip":"::ffff:127.0.0.1","method":"DELETE","statusCode":500,"url":"/v1/media/enterprises/undefined/undefined","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:46.682Z"}
{"level":"info","message":{"duration":"16ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":200,"url":"/v1/auth/resend-verification","userAgent":""},"timestamp":"2026-01-07T18:13:46.738Z"}
{"level":"info","message":{"duration":"6ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":200,"url":"/v1/auth/forgot-password","userAgent":""},"timestamp":"2026-01-07T18:13:46.798Z"}
{"level":"info","message":{"duration":"19ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/subscriptions/plans","userAgent":""},"timestamp":"2026-01-07T18:13:46.859Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"48ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/subscriptions/status","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:46.939Z"}
  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

  console.log
    DEBUG: JwtStrategy validating payload: {"email":"mediauser-1767809624099@example.com","sub":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","iat":1767809625,"exp":1767810525}

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:27:13)

  console.log
    DEBUG: JwtStrategy user found: mediauser-1767809624099@example.com

      at JwtStrategy.validate (../src/modules/auth/strategies/jwt.strategy.ts:36:13)

  console.log
    DEBUG: JwtAuthGuard super.canActivate result: true

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:38:15)

{"level":"info","message":{"duration":"28ms","ip":"::ffff:127.0.0.1","method":"POST","statusCode":200,"url":"/v1/subscriptions/change-plan","user":"9cfd4b1b-afc8-40f6-a04f-a1eb6fb67c51","userAgent":""},"timestamp":"2026-01-07T18:13:47.037Z"}
  console.log
    DEBUG: JwtAuthGuard error: Unauthorized

      at JwtAuthGuard.canActivate (../src/common/guards/jwt-auth.guard.ts:56:15)

{"level":"info","message":{"duration":"8ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":401,"url":"/v1/subscriptions/status","userAgent":""},"timestamp":"2026-01-07T18:13:47.075Z"}
  console.error
    Meilisearch error, falling back to SQL: MeiliSearchCommunicationError: fetch failed
        at node:internal/deps/undici/undici:13178:13
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

    [0m [90m 55 |[39m       [36mreturn[39m [orderedEnterprises[33m,[39m searchResults[33m.[39mestimatedTotalHits][33m;[39m
     [90m 56 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 57 |[39m       console[33m.[39merror([32m'Meilisearch error, falling back to SQL:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 58 |[39m       [36mreturn[39m [36mthis[39m[33m.[39mfallbackSqlSearch(dto)[33m;[39m
     [90m 59 |[39m     }
     [90m 60 |[39m   }[0m

      at SearchService.searchEnterprises (../src/modules/search/search.service.ts:57:15)
      at SearchController.searchEnterprises (../src/modules/search/search.controller.ts:13:34)
      at ../node_modules/@nestjs/core/router/router-execution-context.js:46:28
      at ../node_modules/@nestjs/core/router/router-proxy.js:9:17

{"level":"info","message":{"duration":"129ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/search/enterprises?category=technology&city=seoul&verified=true","userAgent":""},"timestamp":"2026-01-07T18:13:47.281Z"}
  console.error
    Meilisearch error, falling back to SQL: MeiliSearchCommunicationError: fetch failed
        at node:internal/deps/undici/undici:13178:13
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

    [0m [90m 55 |[39m       [36mreturn[39m [orderedEnterprises[33m,[39m searchResults[33m.[39mestimatedTotalHits][33m;[39m
     [90m 56 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 57 |[39m       console[33m.[39merror([32m'Meilisearch error, falling back to SQL:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 58 |[39m       [36mreturn[39m [36mthis[39m[33m.[39mfallbackSqlSearch(dto)[33m;[39m
     [90m 59 |[39m     }
     [90m 60 |[39m   }[0m

      at SearchService.searchEnterprises (../src/modules/search/search.service.ts:57:15)
      at SearchController.searchEnterprises (../src/modules/search/search.controller.ts:13:34)
      at ../node_modules/@nestjs/core/router/router-execution-context.js:46:28
      at ../node_modules/@nestjs/core/router/router-proxy.js:9:17

{"level":"info","message":{"duration":"32ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/search/enterprises?lat=37.5665&lng=126.9780&radius=10","userAgent":""},"timestamp":"2026-01-07T18:13:47.350Z"}
  console.error
    Meilisearch error, falling back to SQL: MeiliSearchCommunicationError: fetch failed
        at node:internal/deps/undici/undici:13178:13
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

    [0m [90m 55 |[39m       [36mreturn[39m [orderedEnterprises[33m,[39m searchResults[33m.[39mestimatedTotalHits][33m;[39m
     [90m 56 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 57 |[39m       console[33m.[39merror([32m'Meilisearch error, falling back to SQL:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 58 |[39m       [36mreturn[39m [36mthis[39m[33m.[39mfallbackSqlSearch(dto)[33m;[39m
     [90m 59 |[39m     }
     [90m 60 |[39m   }[0m

      at SearchService.searchEnterprises (../src/modules/search/search.service.ts:57:15)
      at SearchController.searchEnterprises (../src/modules/search/search.controller.ts:13:34)
      at ../node_modules/@nestjs/core/router/router-execution-context.js:46:28
      at ../node_modules/@nestjs/core/router/router-proxy.js:9:17

{"level":"info","message":{"duration":"24ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/search/enterprises?minPrice=1&maxPrice=3","userAgent":""},"timestamp":"2026-01-07T18:13:47.404Z"}
  console.error
    Meilisearch error, falling back to SQL: MeiliSearchCommunicationError: fetch failed
        at node:internal/deps/undici/undici:13178:13
        at processTicksAndRejections (node:internal/process/task_queues:95:5)

    [0m [90m 55 |[39m       [36mreturn[39m [orderedEnterprises[33m,[39m searchResults[33m.[39mestimatedTotalHits][33m;[39m
     [90m 56 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 57 |[39m       console[33m.[39merror([32m'Meilisearch error, falling back to SQL:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 58 |[39m       [36mreturn[39m [36mthis[39m[33m.[39mfallbackSqlSearch(dto)[33m;[39m
     [90m 59 |[39m     }
     [90m 60 |[39m   }[0m

      at SearchService.searchEnterprises (../src/modules/search/search.service.ts:57:15)
      at SearchController.searchEnterprises (../src/modules/search/search.controller.ts:13:34)
      at ../node_modules/@nestjs/core/router/router-execution-context.js:46:28
      at ../node_modules/@nestjs/core/router/router-proxy.js:9:17

{"level":"info","message":{"duration":"22ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/search/enterprises?sortBy=rating&sortOrder=DESC","userAgent":""},"timestamp":"2026-01-07T18:13:47.462Z"}
{"level":"info","message":{"duration":"4ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/app/version","userAgent":"KoreaBizApp/1.0.0"},"timestamp":"2026-01-07T18:13:47.493Z"}
{"level":"info","message":{"duration":"5ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/enterprises/undefined/mobile","userAgent":""},"timestamp":"2026-01-07T18:13:47.526Z"}
{"level":"info","message":{"duration":"13ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/categories","userAgent":""},"timestamp":"2026-01-07T18:13:47.566Z"}
{"level":"info","message":{"duration":"10ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/categories","userAgent":""},"timestamp":"2026-01-07T18:13:47.606Z"}
{"level":"info","message":{"duration":"10ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/categories/all","userAgent":""},"timestamp":"2026-01-07T18:13:47.645Z"}
{"level":"info","message":{"duration":"9ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/categories/all","userAgent":""},"timestamp":"2026-01-07T18:13:47.683Z"}
{"level":"info","message":{"duration":"13ms","ip":"::ffff:127.0.0.1","method":"GET","statusCode":200,"url":"/v1/search/popular","userAgent":""},"timestamp":"2026-01-07T18:13:47.725Z"}
FAIL test/media-features.e2e-spec.ts (9.175 s)
  Media & File Upload E2E Tests
    â‰¡Æ’Ã´Ã¼ Media Management
      Î“ÃªÃœ should create presigned URL for upload (99 ms)
      â”œÃ¹ should register uploaded media (196 ms)
      â”œÃ¹ should get enterprise media (106 ms)
      Î“ÃªÃœ should validate media type (63 ms)
      Î“ÃªÃœ should validate file size (76 ms)
      Î“ÃªÃœ should require authentication for media operations (65 ms)
      â”œÃ¹ should delete media (165 ms)
    â‰¡Æ’Ã´Âº Email System (Mocked)
      Î“ÃªÃœ should handle email verification (55 ms)
      Î“ÃªÃœ should handle password reset request (57 ms)
    â‰¡Æ’Ã†â”‚ Subscription System
      Î“ÃªÃœ should get subscription plans (60 ms)
      Î“ÃªÃœ should get user subscription status (77 ms)
      Î“ÃªÃœ should change subscription plan (99 ms)
      Î“ÃªÃœ should require authentication for subscription operations (36 ms)
    â‰¡Æ’Ã¶Ã¬ Advanced Search Features
      Î“ÃªÃœ should search with filters (211 ms)
      Î“ÃªÃœ should search with location radius (63 ms)
      Î“ÃªÃœ should search with price range (59 ms)
      Î“ÃªÃœ should sort search results (52 ms)
    â‰¡Æ’Ã´â–’ Mobile API Features
      Î“ÃªÃœ should handle mobile app version check (32 ms)
      Î“ÃªÃœ should get mobile-optimized enterprise data (29 ms)
    â‰¡Æ’Ã®Ã‰ Internationalization
      Î“ÃªÃœ should handle Korean language requests (39 ms)
      Î“ÃªÃœ should handle English language requests (42 ms)
    Î“ÃœÃ­ Caching & Performance
      Î“ÃªÃœ should cache frequently accessed data (76 ms)
      Î“ÃªÃœ should handle cache invalidation (42 ms)

  Î“Ã¹Ã… Media & File Upload E2E Tests Î“Ã‡â•‘ â‰¡Æ’Ã´Ã¼ Media Management Î“Ã‡â•‘ should register uploaded media

    expected 201 "Created", got 500 "Internal Server Error"

      103 |           height: 200
      104 |         })
    > 105 |         .expect(201);
          |          ^
      106 |
      107 |       expect(response.body).toHaveProperty('id');
      108 |       expect(response.body).toHaveProperty('mediaType', 'LOGO');

      at Object.<anonymous> (media-features.e2e-spec.ts:105:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  Î“Ã¹Ã… Media & File Upload E2E Tests Î“Ã‡â•‘ â‰¡Æ’Ã´Ã¼ Media Management Î“Ã‡â•‘ should get enterprise media

    expected 200 "OK", got 500 "Internal Server Error"

      113 |         .get(`/v1/media/enterprises/${enterpriseId}`)
      114 |         .set('Authorization', `Bearer ${userToken}`)
    > 115 |         .expect(200);
          |          ^
      116 |
      117 |       expect(Array.isArray(response.body)).toBe(true);
      118 |     });

      at Object.<anonymous> (media-features.e2e-spec.ts:115:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

  Î“Ã¹Ã… Media & File Upload E2E Tests Î“Ã‡â•‘ â‰¡Æ’Ã´Ã¼ Media Management Î“Ã‡â•‘ should delete media

    expected 200 "OK", got 500 "Internal Server Error"

      172 |         .delete(`/v1/media/enterprises/${enterpriseId}/${mediaId}`)
      173 |         .set('Authorization', `Bearer ${userToken}`)
    > 174 |         .expect(200);
          |          ^
      175 |     });
      176 |   });
      177 |

      at Object.<anonymous> (media-features.e2e-spec.ts:174:10)
      ----
      at Test._assertStatus (../node_modules/supertest/lib/test.js:252:14)
      at ../node_modules/supertest/lib/test.js:308:13
      at Test._assertFunction (../node_modules/supertest/lib/test.js:285:13)
      at Test.assert (../node_modules/supertest/lib/test.js:164:23)
      at Server.localAssert (../node_modules/supertest/lib/test.js:120:14)

Test Suites: 1 failed, 1 total
Tests:       3 failed, 20 passed, 23 total
Snapshots:   0 total
Time:        9.796 s, estimated 12 s
Ran all test suites matching /test\\media-features.e2e-spec.ts/i.
